{% extends 'bases.html.twig' %}

{% block title %}Recherche de lieux{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Recherche dans la ville: {{ city }}</h1>

    <!-- Barre de recherche -->
    <div class="mb-4">
        <input type="text" id="search-input" class="form-control" placeholder="Rechercher une ville..." value="{{ city }}">
        <button class="btn btn-primary mt-2" onclick="searchCity()">Chercher</button>
    </div>

<!-- Barre de navigation pour les types de lieux -->
<div class="mb-4">
   <a href="rechercheHotel.php?city=Lyon&type=hotels">Hôtels</a>
<a href="rechercheHotel.php?city=Lyon&type=musees">Musées</a>
<a href="rechercheHotel.php?city=Lyon&type=restaurants">Restaurants</a>
<a href="rechercheHotel.php?city=Lyon&type=jardins">Jardins</a>

</div>
    <!-- Carte -->
    <div id="map" style="height: 400px;"></div>
</div>

<!-- Intégration de Leaflet.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    // Initialisation de la carte centrée par défaut (Paris)
    var map = L.map('map').setView([48.8566, 2.3522], 13); // Paris par défaut
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Fonction pour obtenir la couleur du marqueur en fonction du type
    function getMarkerColor(type) {
        switch(type) {
            case 'hotels': return 'blue'; // Bleu pour les hôtels
            case 'musees': return 'red';  // Rouge pour les musées
            case 'jardins': return 'green'; // Vert pour les jardins
            case 'restaurants': return 'yellow'; // Jaune pour les restaurants
            default: return 'gray'; // Couleur par défaut
        }
    }

    {% if places is not empty %}
        // Ajouter les marqueurs pour chaque lieu trouvé
        {% for place in places %}
            var markerColor = getMarkerColor("{{ place.type }}"); // Récupérer le type du lieu
            L.circleMarker([{{ place.lat }}, {{ place.lon }}], {
                color: markerColor, 
                radius: 8, // Taille du marqueur
                fillOpacity: 0.6
            })
            .addTo(map)
            .bindPopup("<b>{{ place.name }}</b>");
        {% endfor %}

        // Ajuster la vue de la carte pour inclure tous les marqueurs
        var bounds = [
            {% for place in places %}
                [{{ place.lat }}, {{ place.lon }}],
            {% endfor %}
        ];
        map.fitBounds(bounds);
    {% endif %}

    // Fonction pour rechercher une ville
    function searchCity() {
        var city = document.getElementById('search-input').value;
        if (city.trim() !== '') {
            window.location.href = '?city=' + city; // Recharger la page avec la ville recherchée
        }
    }
</script>

{% endblock %}
